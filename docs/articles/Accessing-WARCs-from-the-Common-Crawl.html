<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Accessing WARCs from the Common Crawl • ccwarcs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Accessing WARCs from the Common Crawl">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ccwarcs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Accessing-WARCs-from-the-Common-Crawl.html">Accessing WARCs from the Common Crawl</a>
    </li>
    <li>
      <a href="../articles/introduction-to-ccwarcs.html">Introduction to ccwarcs</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Accessing WARCs from the Common Crawl</h1>
            
      
      
      <div class="hidden name"><code>Accessing-WARCs-from-the-Common-Crawl.Rmd</code></div>

    </div>

    
    
<p>Load libraries.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ccwarcs)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; ── Attaching packages ────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; ✔ ggplot2 3.2.1     ✔ purrr   0.3.2</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; ✔ tibble  2.1.3     ✔ dplyr   0.8.3</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; ✔ tidyr   0.8.3     ✔ stringr 1.4.0</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; ✔ readr   1.3.1     ✔ forcats 0.4.0</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; ── Conflicts ───────────────────────────────────────────────────────────── tidyverse_conflicts() ──</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rvest)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; Loading required package: xml2</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; Attaching package: 'rvest'</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; The following object is masked from 'package:purrr':</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt;     pluck</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; The following object is masked from 'package:readr':</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#&gt;     guess_encoding</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidytext)</a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tm)</a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#&gt; Loading required package: NLP</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt; Attaching package: 'NLP'</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">#&gt; The following object is masked from 'package:ggplot2':</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">#&gt;     annotate</span></a></code></pre></div>
<p>Test whether AWS credentials can be located.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../reference/test_AWS_credentials.html">test_AWS_credentials</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span>()</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; Locating credentials</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; Checking for credentials in user-supplied values</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; Checking for credentials in Environment Variables</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; Using Environment Variable 'AWS_ACCESS_KEY_ID' for AWS Access Key ID</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; Using Environment Variable 'AWS_SECRET_ACCESS_KEY' for AWS Secret Access Key</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; Using default value for AWS Region ('us-east-1')</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; AWS credentials were found.</span></a></code></pre></div>
<p>Create a new <code>ccwarcs_options</code> object with default values. If the directory <code>~/.ccwarcs_cache</code> does not already exist, the package will ask if you would like to create it.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">opts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ccwarcs_options.html">ccwarcs_options</a></span>()</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">opts</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; $cache</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; [1] "~/.ccwarcs_cache"</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; $cdx_sleep</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; [1] 0.3</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; $page_size</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; attr(,"class")</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; [1] "ccwarcs_options"</span></a></code></pre></div>
<p>Get the current list of crawls.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">crawls &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/cdx_fetch_list_of_crawls.html">cdx_fetch_list_of_crawls</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/Extract.html">getElement</a></span>(<span class="st">'id'</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">crawls</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;  [1] "2019-35"   "2019-30"   "2019-26"   "2019-22"   "2019-18"  </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;  [6] "2019-13"   "2019-09"   "2019-04"   "2018-51"   "2018-47"  </span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; [11] "2018-43"   "2018-39"   "2018-34"   "2018-30"   "2018-26"  </span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; [16] "2018-22"   "2018-17"   "2018-13"   "2018-09"   "2018-05"  </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; [21] "2017-51"   "2017-47"   "2017-43"   "2017-39"   "2017-34"  </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; [26] "2017-30"   "2017-26"   "2017-22"   "2017-17"   "2017-13"  </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; [31] "2017-09"   "2017-04"   "2016-50"   "2016-44"   "2016-40"  </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; [36] "2016-36"   "2016-30"   "2016-26"   "2016-22"   "2016-18"  </span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; [41] "2016-07"   "2015-48"   "2015-40"   "2015-35"   "2015-32"  </span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; [46] "2015-27"   "2015-22"   "2015-18"   "2015-14"   "2015-11"  </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; [51] "2015-06"   "2014-52"   "2014-49"   "2014-42"   "2014-41"  </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; [56] "2014-35"   "2014-23"   "2014-15"   "2014-10"   "2013-48"  </span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; [61] "2013-20"   "2012"      "2009-2010" "2008-2009"</span></a></code></pre></div>
<p>Search for archived articles published in 2018.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">url &lt;-<span class="st"> "https://www.sciencemag.org/news/2018/*"</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">idx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_cc_index.html">get_cc_index</a></span>(url, crawls[<span class="dv">1</span>], <span class="dt">.options =</span> opts)</a></code></pre></div>
<p>Get the HTML of the archived articles.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">warcs &lt;-</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span>idx <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(status <span class="op">==</span><span class="st"> </span><span class="dv">200</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">page =</span> <span class="kw"><a href="../reference/get_warc.html">get_warc</a></span>(filename, offset,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">                         length, digest,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                         <span class="dt">.options =</span> opts))</a></code></pre></div>
<p>If you would like to look at the contents of the archived HTML, you can do something like the following. The code below saves the HTML to a temporary file location, then opens it in a web browser.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">browse_html_string &lt;-<span class="st"> </span><span class="cf">function</span>(html)  {</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  fp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>(<span class="dt">fileext =</span> <span class="st">'.html'</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  readr<span class="op">::</span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_file.html">write_file</a></span>(html, fp)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="kw"><a href="https://rdrr.io/r/utils/browseURL.html">browseURL</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"file://"</span>, fp))</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">warcs<span class="op">$</span>page[<span class="dv">1</span>]  <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw">browse_html_string</span>()</a></code></pre></div>
<p>Looking at one of the web pages (using the code above), determine which part of the page you want to extract. For these articles, the article’s main text can be obtained with the code below.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">article_text_from_html_string &lt;-<span class="st"> </span><span class="cf">function</span>(html) {</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  html <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="https://rvest.tidyverse.org/reference/minimal_html.html">minimal_html</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="https://rvest.tidyverse.org/reference/html_nodes.html">html_nodes</a></span>(<span class="st">".article__body p"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="https://rvest.tidyverse.org/reference/html_text.html">html_text</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">    </span><span class="kw">str_c</span>(<span class="dt">collapse =</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">warcs<span class="op">$</span>page[<span class="dv">1</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="st">  </span><span class="kw">article_text_from_html_string</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="st">  </span><span class="kw">str_trunc</span>(<span class="dv">500</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="st">  </span><span class="kw">str_replace_all</span>(<span class="st">'</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">n</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">n'</span>, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>()</a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; A chip that traps ions is the basis for a Department of Energy testbed quantum computer.</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;   By Adrian ChoJan. 10, 2018 , 3:00 PM</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; The U.S. Department of Energy (DOE) is joining the quest to develop quantum computers, devices that would exploit quantum mechanics to crack problems that overwhelm conventional computers. The initiative comes as Google and other companies race to build a quantum computer that can demonstrate “quantum supremacy” by beating classical computers on a test problem. But ...</span></a></code></pre></div>
<p>Extract the article text for all archived HTML pages.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">articles &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span>warcs  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">article =</span> <span class="kw">map_chr</span>(page,  <span class="op">~</span><span class="kw">article_text_from_html_string</span>(.x)))</a></code></pre></div>
<p>Use the <code>tidytext</code> package to tokenize the articles into words. Then remove common words (<code>stop_words</code>) and “words” comprising only numbers.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">article_words &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span>articles <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(timestamp,  urlkey,  article) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span>(<span class="dt">output =</span> <span class="st">'word'</span>, <span class="dt">input =</span> <span class="st">'article'</span>, </a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                <span class="dt">token =</span> <span class="st">'words'</span>,  <span class="dt">format =</span> <span class="st">'text'</span>, </a>
<a class="sourceLine" id="cb10-6" data-line-number="6">                <span class="dt">to_lower =</span> <span class="ot">TRUE</span>, <span class="dt">drop =</span> <span class="ot">TRUE</span>)  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="st">  </span><span class="kw">anti_join</span>(stop_words, <span class="dt">by =</span> <span class="st">'word'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="op">!</span><span class="kw">str_detect</span>(word, <span class="st">'^[0-9</span><span class="ch">\\</span><span class="st">.,]+$'</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">str_extract</span>(urlkey, <span class="st">'/2018/[0-9]{2}/'</span>),</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">         <span class="dt">month =</span> <span class="kw"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="kw">str_sub</span>(month, <span class="dv">7</span>, <span class="dv">8</span>)))</a></code></pre></div>
<p>For each month, pool all words together, then calculate the term frequency - inverse document frequency. Visualize the top 10 words per month.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">article_words <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(month, word, <span class="dt">article =</span> urlkey) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(month, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidytext/man/bind_tf_idf.html">bind_tf_idf</a></span>(word, month, n) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">10</span>, tf_idf) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">row_number</span>() <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(word, <span class="dt">ordered =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_reorder</span>(<span class="op">-</span>tf_idf))  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(term)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> term,  <span class="dt">y =</span> tf_idf)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">'identity'</span>)  <span class="op">+</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>month, <span class="dt">scale =</span> <span class="st">'free_x'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">60</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="Accessing-WARCs-from-the-Common-Crawl_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>For each article, calculate the Tf-Idf, then plot the most distinctive words across all articles in 2018.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">article_words <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(word, <span class="dt">article =</span> urlkey) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(article, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/tidytext/man/bind_tf_idf.html">bind_tf_idf</a></span>(word, article, n) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(word) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, tf_idf) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">30</span>, tf_idf) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(word, <span class="dt">ordered =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_reorder</span>(<span class="op">-</span>tf_idf))  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> term, <span class="dt">y =</span> tf_idf)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">'identity'</span>)  <span class="op">+</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">60</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="Accessing-WARCs-from-the-Common-Crawl_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jason Roos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
